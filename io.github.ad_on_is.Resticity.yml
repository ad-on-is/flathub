id: io.github.ad_on_is.Resticity
runtime: org.gnome.Platform
runtime-version: '3.38'
sdk: org.gnome.Sdk


command: resticity
finish-args:
  - --share=ipc # Share IPC namespace with the host (necessary for X11).
  - --socket=wayland
  - --socket=fallback-x11
  - --device=dri # OpenGL rendering support.
  - --talk-name=org.freedesktop.Notifications
  - --filesystem=home
  - --filesystem=host
  - --share=network
  - --talk-name=org.kde.StatusNotifierWatcher



modules:
  - shared-modules/libappindicator/libappindicator-gtk3-12.10.json
  - shared-modules/libsoup/libsoup-2.4.json
  - name: rclone
    buildsystem: simple
    build-commands:
      - mkdir -p /app/bin
      - install -Dm755 rclone /app/bin/rclone  
      - chmod a+x /app/bin/rclone
    sources:
      - type: archive
        only-arches: [x86_64]
        url: https://downloads.rclone.org/v1.66.0/rclone-v1.66.0-linux-amd64.zip
        sha256: b4d304b1dc76001b1d3bb820ae8d1ae60a072afbd3296be904a3ee00b3d4fab9
      - type: archive
        only-arches: [aarch64]
        url: https://downloads.rclone.org/v1.66.0/rclone-v1.66.0-linux-arm64.zip
        sha256: c50a3ab93082f21788f9244393b19f2426edeeb896eec2e3e05ffb2e8727e075
  - name: restic
    buildsystem: simple
    build-commands:
      - mkdir -p /app/bin
      - bzcat restic_*.bz2 > /app/bin/restic
      - chmod a+x /app/bin/restic
    sources:
      - type: file
        only-arches: [x86_64]
        url: https://github.com/restic/restic/releases/download/v0.16.4/restic_0.16.4_linux_amd64.bz2
        sha256: 3d4d43c169a9e28ea76303b1e8b810f0dcede7478555fdaa8959971ad499e324
      - type: file
        only-arches: [aarch64]
        url: https://github.com/restic/restic/releases/download/v0.16.4/restic_0.16.4_linux_arm64.bz2
        sha256: 9d2f44538ea0c6309426cb290d3a6b8b0b85de5de7f1496ff40c843b36bf8a8d
  - name: resticity
    buildsystem: simple
    build-commands:
      - install -Dm00755 lib/* $FLATPAK_DEST/lib/
      - ln -s /usr/libexec /app/libexec
      - install -Dm00755 resticity $FLATPAK_DEST/bin/resticity
      - install -Dm00644 $FLATPAK_ID.png $FLATPAK_DEST/share/icons/hicolor/256x256/apps/$FLATPAK_ID.png
      - install -Dm00644 $FLATPAK_ID.desktop $FLATPAK_DEST/share/applications/$FLATPAK_ID.desktop
      - install -Dm00644 $FLATPAK_ID.appdata.xml $FLATPAK_DEST/share/appdata/$FLATPAK_ID.appdata.xml
    sources:
      - type: dir
        path: .



  
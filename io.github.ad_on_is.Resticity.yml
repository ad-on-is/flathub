id: io.github.ad_on_is.Resticity
runtime: org.gnome.Platform
runtime-version: '3.38'
sdk: org.gnome.Sdk


command: resticity
finish-args:
  - --share=ipc # Share IPC namespace with the host (necessary for X11).
  - --socket=wayland
  - --socket=fallback-x11
  - --device=dri # OpenGL rendering support.
  - --talk-name=org.freedesktop.Notifications
  - --filesystem=home
  - --filesystem=host
  - --share=network
  - --talk-name=org.kde.StatusNotifierWatcher

modules:
  
  - name: rclone
    buildsystem: simple
    build-commands:
      - mkdir -p $FLATPAK_DEST/bin
      - install -Dm755 rclone $FLATPAK_DEST/bin/rclone  
      - chmod a+x $FLATPAK_DEST/bin/rclone
    sources:
      - type: archive
        only-arches: [x86_64]
        url: https://downloads.rclone.org/v1.66.0/rclone-v1.66.0-linux-amd64.zip
        sha256: b4d304b1dc76001b1d3bb820ae8d1ae60a072afbd3296be904a3ee00b3d4fab9
      - type: archive
        only-arches: [aarch64]
        url: https://downloads.rclone.org/v1.66.0/rclone-v1.66.0-linux-arm64.zip
        sha256: c50a3ab93082f21788f9244393b19f2426edeeb896eec2e3e05ffb2e8727e075
  - name: restic
    buildsystem: simple
    build-commands:
      - mkdir -p $FLATPAK_DEST/bin
      - bzcat restic_*.bz2 > $FLATPAK_DEST/bin/restic
      - chmod a+x $FLATPAK_DEST/bin/restic
    sources:
      - type: file
        only-arches: [x86_64]
        url: https://github.com/restic/restic/releases/download/v0.16.4/restic_0.16.4_linux_amd64.bz2
        sha256: 3d4d43c169a9e28ea76303b1e8b810f0dcede7478555fdaa8959971ad499e324
      - type: file
        only-arches: [aarch64]
        url: https://github.com/restic/restic/releases/download/v0.16.4/restic_0.16.4_linux_arm64.bz2
        sha256: 9d2f44538ea0c6309426cb290d3a6b8b0b85de5de7f1496ff40c843b36bf8a8d
  - name: resources
    buildsystem: simple
    build-commands:
      - ls packaging/flatpak
      - install -Dm00644 packaging/$FLATPAK_ID.png $FLATPAK_DEST/share/icons/hicolor/256x256/apps/$FLATPAK_ID.png
      - install -Dm00644 packaging/$FLATPAK_ID.desktop $FLATPAK_DEST/share/applications/$FLATPAK_ID.desktop
      - install -Dm00644 packaging/flatpak/$FLATPAK_ID.appdata.xml $FLATPAK_DEST/share/appdata/$FLATPAK_ID.appdata.xml
    sources:
      - type: archive
        url: https://github.com/ad-on-is/resticity/archive/refs/tags/1.0.44.zip
        sha256: 46eb95ac75e35c7ae7a169cc8a5d4461d8941c96bba8e7aea3fc894c69665614

  - name: resticity
    buildsystem: simple
    build-commands:
      - mkdir -p $FLATPAK_DEST/bin
      - install -Dm755 resticity $FLATPAK_DEST/bin/resticity
      - chmod a+x $FLATPAK_DEST/bin/resticity
    sources:
      - type: file
        url: https://github.com/ad-on-is/resticity/releases/download/1.0.44/resticity
        sha256: 3d67fab83b7d87bc184b122232dda10ad08c06e7f0ff378e5e466c74f3d7ad1c



  